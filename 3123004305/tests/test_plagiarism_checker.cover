    1: import io
    1: import sys
    1: import tempfile
    1: import unittest
    1: from contextlib import redirect_stdout
    1: from pathlib import Path
       
    1: ROOT = Path(__file__).resolve().parents[1]
    1: if str(ROOT) not in sys.path:
    1:     sys.path.insert(0, str(ROOT))
       
    1: import plagiarism_checker as pc
       
       
    2: class TestPlagiarismChecker(unittest.TestCase):
    1:     def test_identical_text(self) -> None:
    1:         text = "Deep learning models need data"
    1:         self.assertAlmostEqual(pc.compute_similarity(text, text), 1.0)
       
    1:     def test_disjoint_text(self) -> None:
    1:         a = "machine learning improves performance"
    1:         b = "basketball tactics require teamwork"
    1:         self.assertAlmostEqual(pc.compute_similarity(a, b), 0.0)
       
    1:     def test_case_and_punctuation_insensitive(self) -> None:
    1:         a = "Hello, World!"
    1:         b = "hello world"
    1:         self.assertAlmostEqual(pc.compute_similarity(a, b, window=2), 1.0)
       
    1:     def test_partial_overlap(self) -> None:
    1:         a = "a b c d"
    1:         b = "a b x y"
    1:         score = pc.compute_similarity(a, b, window=2)
    1:         self.assertAlmostEqual(score, 0.2)
       
    1:     def test_window_larger_than_words(self) -> None:
    1:         a = "only two"
    1:         b = "only three words"
    1:         score = pc.compute_similarity(a, b, window=3)
    1:         self.assertEqual(score, 0.0)
       
    1:     def test_empty_both(self) -> None:
    1:         self.assertEqual(pc.compute_similarity("", ""), 1.0)
       
    1:     def test_empty_vs_nonempty(self) -> None:
    1:         self.assertEqual(pc.compute_similarity("", "content here"), 0.0)
       
    1:     def test_invalid_window(self) -> None:
    1:         with self.assertRaises(ValueError):
    2:             pc.build_shingles(["a", "b"], window=0)
       
    1:     def test_similarity_from_files(self) -> None:
    1:         with tempfile.TemporaryDirectory() as tmp:
    1:             orig = Path(tmp) / "orig.txt"
    1:             suspect = Path(tmp) / "suspect.txt"
    1:             orig.write_text("natural language processing", encoding="utf-8")
    1:             suspect.write_text("language processing tasks", encoding="utf-8")
    1:             score = pc.similarity_from_files(orig, suspect, window=2)
    1:         expected = pc.compute_similarity("natural language processing", "language processing tasks", window=2)
    1:         self.assertAlmostEqual(score, expected)
       
    1:     def test_cli_outputs_percentage(self) -> None:
    1:         with tempfile.TemporaryDirectory() as tmp:
    1:             orig = Path(tmp) / "orig.txt"
    1:             suspect = Path(tmp) / "suspect.txt"
    1:             orig.write_text("A B C", encoding="utf-8")
    1:             suspect.write_text("A B D", encoding="utf-8")
       
    1:             buffer = io.StringIO()
    1:             with redirect_stdout(buffer):
    1:                 pc.main([str(orig), str(suspect), "--window", "2"])
    1:             output = buffer.getvalue().strip()
       
               # With window=2, shingles are {AB, BC} vs {AB, BD} => 1/3 overlap = 33.33%
    1:         self.assertEqual(output, "33.33%")
       
    1:     def test_format_percentage_bounds(self) -> None:
    1:         self.assertEqual(pc.format_percentage(1.5), "100.00%")
    1:         self.assertEqual(pc.format_percentage(-0.2), "0.00%")
       
       
    1: if __name__ == "__main__":
           unittest.main()
